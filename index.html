<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vascularmodel: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vascularmodel
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md9">Building the libraries</a><ul><li class="level2"><a href="#autotoc_md10">Patches</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md11">Supported operating systems</a></li>
<li class="level1"><a href="#autotoc_md12">Making built externals available for distribution</a></li>
</ul>
</div>
<div class="textblock"><p>This repository contains scripts to build the external libraries needed to compile the SimVascular GUI. SimVascular relies on the following external libraries:</p><ol type="1">
<li><a href="https://github.com/leethomason/tinyxml2">Tinyxml2</a></li>
<li><a href="https://www.qt.io">Qt5</a></li>
<li><a href="https://freetype.org">Freetype</a></li>
<li><a href="https://github.com/malaterre/GDCM/">GDCM</a></li>
<li><a href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a></li>
<li><a href="https://github.com/MmgTools/mmg/">MMG</a></li>
<li><a href="https://www.python.org">Python</a></li>
<li><a href="https://www.opencascade.com">Opencascade</a></li>
<li><a href="https://github.com/swig/swig">Swig</a></li>
<li><a href="https://itk.org">ITK</a></li>
<li><a href="https://vtk.org">VTK</a></li>
<li><a href="https://github.com/MITK/MITK">MITK</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md9"></a>
Building the libraries</h1>
<p>The <code>scripts</code> folder contains scripts to build each of the external libraries (e.g., <code>build_tinyxml2.sh</code>, <code>build_qt5.sh</code>, and so on). These scripts use environment variables defined in <code>env_variables.sh</code> and require the creation of two folders: one to save the source files (<code>SRC_DIR</code>, defined in <code>env_variables.sh</code>) and one to save the installed libraries (<code>INSTALL_DIR</code>, defined in <code>env_variables.sh</code>). The pipeline to build, for example, HDF5, looks as follows: </p><div class="fragment"><div class="line">source env_variables.sh</div>
<div class="line">mkdir -p $SRC_DIR</div>
<div class="line">mkdir -p $INSTALL_DIR</div>
<div class="line">bash scripts/build_hdf5.sh</div>
</div><!-- fragment --><p> Note that libraries should be built in a specific order due to dependencies. The script <code>build_all.sh</code> runs all the scripts in the right sequence. We recommended consulting <code>build_all.sh</code> to understand if building a particular library requires the execution of multiple scripts. For example, MITK requires running <code>post-install-mitk.sh</code> to change the install folder structure (this script is necessary due to the organization that SimVascular expects for the MITK installation directory, and was already present in the previous build system).</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Patches</h2>
<p>Library-specific patches are available in the <code>patches</code> folder. We found that these modifications to the original source files were necessary to compile the library itself or SimVascular. The patches are automatically applied to source files when executing the scripts containied in <code>scripts</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Supported operating systems</h1>
<p>Using this repository, we were able to successfully build the external libraries on the following operating systems:</p><ol type="1">
<li>Ubuntu 20</li>
<li>Ubuntu 22</li>
<li>MacOS 12 (Monterey)</li>
<li>MacOS 13 (Ventura)</li>
</ol>
<p>Windows systems have not been tested yet. We created some docker containers with the required dependencies to facilitate building the externals on different machines; see <a href="https://simvascular.github.io/svExternals/containers.html">this page</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Making built externals available for distribution</h1>
<p>During compilation, SimVascular automatically downloads the external libraries from our server Tetralogy. The different library versions are located here </p><div class="fragment"><div class="line">/home/www-shared/html/downloads/public/simvascular/externals </div>
</div><!-- fragment --><p> For example, the 2019.06 version of the external libraries for Ubuntu 20.04 are located here: </p><div class="fragment"><div class="line">/home/www-shared/html/downloads/public/simvascular/externals/2019.06/linux/ubuntu/20.04/gnu/7.5/x64/release/2021.06.10</div>
</div><!-- fragment --><p> The libraries names need to follow a specific convention to be found by SimVascular. For example: </p><div class="fragment"><div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.freetype.2.6.3.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.gdcm.2.6.3.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.hdf5.1.10.1.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.itk.4.13.2.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.mitk.2018.04.2.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.mmg.5.3.9.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.opencascade.7.3.0.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.python.3.5.5.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.qt.5.11.3.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.swig.3.0.12.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.tcltk.8.6.4.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.tinyxml2.6.2.0.tar.gz</div>
<div class="line">ubuntu.20.04.gnu.7.5.x64.release.2021.06.10.vtk.8.1.1.tar.gz</div>
</div><!-- fragment --><p> When the libraries are built using GitHub actions (see <a href="https://simvascular.github.io/svExternals/containers.html">this page</a> for more details), the externals can be downloaded automatically from GitHub and renamed using the right convention using this script: </p><div class="fragment"><div class="line">import os</div>
<div class="line">import json</div>
<div class="line"> </div>
<div class="line">gh_token = # insert github token here. This must be generated using the SimVascular GitHub account</div>
<div class="line">gh_repo = &#39;https://api.github.com/repos/simvascular/svExternals/actions/artifacts&#39;</div>
<div class="line"> </div>
<div class="line">zip_prefix = &#39;ubuntu.20.04.gnu.7.5.x64.release.2022.10.13.&#39; # this should be customized based on the location of the library on tetra</div>
<div class="line"> </div>
<div class="line">if __name__ == &quot;__main__&quot;:</div>
<div class="line">    command = &#39;curl -L -H &quot;Accept: application/vnd.github+json&quot; &#39;</div>
<div class="line">    command += &#39;-H &quot;Authorization: Bearer {:}&quot; &#39;.format(gh_token)</div>
<div class="line">    command += &#39;-H &quot;X-GitHub-Api-Version: 2022-11-28&quot; &#39;</div>
<div class="line">    command += &#39;{:} &gt; artifacts.json&#39;.format(gh_repo)</div>
<div class="line">    os.system(command)</div>
<div class="line"> </div>
<div class="line">    artinfo = json.load(open(&#39;artifacts.json&#39;))</div>
<div class="line">    </div>
<div class="line">    art_dict = {}</div>
<div class="line"> </div>
<div class="line">    for ext in artinfo[&#39;artifacts&#39;]:</div>
<div class="line">        if &#39;Ubuntu 20&#39; in ext[&#39;name&#39;]: # Change Ubuntu 20 to the current OS</div>
<div class="line">            if ext[&#39;name&#39;] not in art_dict:</div>
<div class="line">                art_dict[ext[&#39;name&#39;]] = ext</div>
<div class="line">            else:</div>
<div class="line">                # if the current artifact has been created after the stored one,</div>
<div class="line">                # we updatels it</div>
<div class="line">                if ext[&#39;updated_at&#39;] &gt; art_dict[ext[&#39;name&#39;]][&#39;updated_at&#39;]:</div>
<div class="line">                    art_dict[ext[&#39;name&#39;]] = ext</div>
<div class="line"> </div>
<div class="line">    os.system(&#39;rm artifacts.json&#39;)</div>
<div class="line"> </div>
<div class="line">    for art_name, art_value in art_dict.items():</div>
<div class="line">        file_name = art_name.replace(&#39; &#39;,&#39;-&#39;).lower()</div>
<div class="line">        command = &#39;curl -L -H &quot;Accept: application/vnd.github+json&quot; &#39;</div>
<div class="line">        command += &#39;-H &quot;Authorization: Bearer {:}&quot; &#39;.format(gh_token)</div>
<div class="line">        command += &#39;-H &quot;X-GitHub-Api-Version: 2022-11-28&quot; &#39;</div>
<div class="line">        command += &#39;{:}/{:}/zip --output {:}.zip&#39;.format(gh_repo, </div>
<div class="line">                                                         art_value[&#39;id&#39;],</div>
<div class="line">                                                         file_name)</div>
<div class="line">        os.system(command)</div>
<div class="line">        os.system(&#39;unzip {:}.zip&#39;.format(file_name))</div>
<div class="line">        for f in os.listdir(&#39;.&#39;):</div>
<div class="line">            if &#39;.tar&#39; in f:</div>
<div class="line">                os.system(&#39;tar -xf {:}&#39;.format(f))</div>
<div class="line">                os.system(&#39;rm {:}&#39;.format(f))</div>
<div class="line">                break</div>
<div class="line">        os.system(&#39;rm {:}.zip&#39;.format(file_name))</div>
<div class="line"> </div>
<div class="line">    for lib in os.listdir(&#39;.&#39;):</div>
<div class="line">        if &#39;.json&#39; not in lib and &#39;.py&#39; not in lib:</div>
<div class="line">            tar_name = zip_prefix + lib.replace(&#39;-&#39;,&#39;.&#39;) + &#39;.tar.gz&#39;</div>
<div class="line">            os.system(&#39;tar -czvf {:} {:}&#39;.format(tar_name, lib))</div>
<div class="line">            os.system(&#39;rm -rf {:}&#39;.format(lib))</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
